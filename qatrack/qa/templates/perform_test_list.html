{% extends "site_base.html" %}
{% load staticfiles %}

{% block extra_style %}
    <link href="{% static "css/qa.css" %}" rel="stylesheet">
    <link href="{% static "datepicker/css/datepicker.css" %}" rel="stylesheet">
{% endblock %}


{% load qa_tags %}

{% block body %}

<div class="row-fluid">
	<div class="span12">
		<div id="contact-container" class="pull-right alert alert-info">

				<span id="toggle-contacts" class="pull-right hand-cursor">
					Contact Numbers <i class="icon-plus-sign"></i>
				</span>
				<div class="clearfix"></div>
				<div id="contacts" class="clearfix">
					<hr/>
					<dl class="dl-horizontal">
						{% for contact in contacts %}
							<dt><abbr title="{{contact.description}}">{{contact.name}}</abbr></dt>
							<dd>{{contact.number}}</dd>
						{% endfor %}
					</dl>
				</div>

		</div>
	</div>
</div>
<div class="row-fluid">
    <div class="span12">
		<form class="nosubmit form-inline" id="qa-form" method="POST" action="">
			{% csrf_token %}

			<div id="admin_controls" class="well">
				{% if include_admin %}

					<div class="input-prepend input-append" id="category">
						<label for="category_filter" class="add-on">
							Categories:
						</label>
						<select id="category_filter" multiple="multiple" class="input-medium">
							<option value="all">Show All</option>
							{% for category in categories %}
								<option value="{{category.name|lower}}">
									{{category.name|title}}
								</option>
							{% endfor %}
						</select>
					</div>
				{% endif %}

				<div class="date input-prepend input-append" id="work-started" data-date="{% now 'd-m-Y'%}" data-date-format="dd-mm-yyyy">
					{% spaceless %}
					<label for="id_work_started" class="add-on">
						{{form.work_started.label}}:
					</label>
					<input name="work_started" {% if not include_admin %}disabled="disabled"{% endif %} title="Format DD-MM-YY hh:mm (hh:mm is 24h time e.g. 31-05-12 14:30)" value="{% now "d-m-Y H:i" %}" class="input-medium" type="text" id="id_work_started">
					{% if include_admin%}
						<span class="add-on"><i class="icon-th"></i></span>
					{% endif %}
					{% for error in form.errors.work_started %}
						<span class="alert-error help-block-inline">{{ error }} {{form.work_started.help_text}}</span>
					{% endfor %}
					{% endspaceless %}
				</div>

				{% if include_admin %}
					<div class="date input-prepend input-append" id="work-completed" data-date="{% now 'd-m-Y'%}" data-date-format="dd-mm-yyyy">
						<label for="id_work_completed" class="add-on">
							{{form.work_completed.label}}:
						</label>{{form.work_completed}}<span class="add-on"><i class="icon-th"></i></span>
						{% for error in form.errors.work_completed %}
							<span class="alert-error help-block-inline">{{ error }} {{form.work_completed.help_text}}</span>
						{% endfor %}
					</div>

					<div class="input-prepend input-append" id="status">
						<label for="id_status" class="add-on">
							Set Status:
						</label>{{form.status}}
						{% for error in form.errors.status %}
							<span class="alert-error help-block-inline">{{ error }} {{form.work_completed.help_text}}</span>
						{% endfor %}
					</div>

				{% endif %}

				{% if days %}

					<div class="input-prepend input-append" id="cycle-day-wrapper">
						<label for="cycle-day" class="add-on">
							Choose Day:
						</label>
						<select id="cycle-day" class="input-small" {% if not days %}disabled="disabled"{%endif%}>
							<option value="next">Next scheduled</option>
							{% for day in days %}
								<option value="{{day}}" {% if day == current_day %}selected="selected"{% endif %}>
									Day {{day}}
								</option>
							{% endfor %}
						</select><a href="#" class="btn add-on" type="button" {% if days %}id="change-test-list"{%endif%}>Go</a>
					</div>
				{% endif %}

			</div>


			{# display any form errors up top #}
			{% if form.errors %}
				<div class="alert-message error">
					{% for field,errors in form.errors.items %}
						{% if field != "work_completed" %}
							{% for error in errors %}
								<span class="alert-error help-block-inline ">{{ error }}</span>
							{% endfor %}
						{% endif %}
					{% endfor %}
				</div>
			{% endif %}

			{% if formset.non_form_errors %}
				<div class="alert-message error">
					{% for error in formset.non_form_errors %}
						<span class="alert-error help-block-inline">{{ error }}</span>
					{% endfor %}
				</div>
			{% endif %}


			{{formset.management_form}}

			<table class="qa-table table table-bordered table-striped table-condensed" >
				<thead>
					<tr>
						<th class="qa-showproc qa-name">Name<div></div></th>
						<th class="qa-category">Category</th>
						<th class="qa-value" width=100>Value</th>
						<th class="qa-skip">Skip</th>
						<th class="qa-status">Status</th>
						<th class="qa-showcmt">Comment</th>
						{% if include_admin %}
							<th class="qa-reference">Reference</th>
							<th class="qa-history">History<br/>
								{% for d in history_dates %}
									<span class="label history-label" title="{{d}}">{{d|date:"dMy"}}</span>
								{% endfor %}
							<div></div></th>
						{% endif %}
					</tr>
				</thead>
				<tbody>
				{% for test_form in formset %}
					{{test_form|as_qavalue:include_admin}}
				{% endfor %}
				</tbody>
			</table>

			<div class="row-fluid">
				<div class="span12">
					<a id="toggle-gen-comment" class="btn pull-right" href="#" title="Click here to add a general comment about this set of tests"><i class="icon-comment"></i> Add Comment</a>
				</div>
			</div>
			<div class="row-fluid">
				<div class="span12 qa-tli-comment">
					{{form.comment}}
				</div>
			</div>
			<div class="row-fluid">
				<div class="span12">
					<button type="submit" class="btn btn-primary pull-right">Submit QA Results</button>
				</div>
			</div>
		</form>


    </div>
</div>

{% endblock %}

{% block end_body_extra_script %}
    <script type="text/javascript" src="{% static "js/json2.js" %}"></script>

    <script src="{% static "js/qa.js" %}"></script>
    <script src="{% static "datepicker/js/bootstrap-datepicker.js" %}"></script>

{% endblock %}
